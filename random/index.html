<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Random numbers - MicroTBX User Manual</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Random numbers";
        var mkdocs_page_input_path = "random.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> MicroTBX User Manual
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../apiref/">API reference</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../misra/">MISRA compliance</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../license/">License</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../assertions/">Assertions</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../critsect/">Critical sections</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../heap/">Heap</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../mempools/">Memory pools</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../lists/">Linked lists</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Random numbers</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#examples">Examples</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../checksum/">Checksums</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../crypto/">Cryptography</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../platform/">Platform</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../extra/">Extra functionality</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">MicroTBX User Manual</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Random numbers</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/feaser/microtbx/edit/master/docs/random.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="random-numbers">Random numbers</h1>
<p>The random number generator software component offers functionality for
generating 32-bit random numbers. The generator algorithm is based on the linear
feedback shift register approach (<a href="https://en.wikipedia.org/wiki/Linear-feedback_shift_register">LFSR</a>), specifically the one presented in <a href="https://www.maximintegrated.com/en/app-notes/index.mvp/id/4400">application note 4400</a> from Maxim Integrated.</p>
<h2 id="usage">Usage</h2>
<p>Whenever a random number is to be obtained, call function <a href="../apiref/#tbxrandomnumberget"><code>TbxRandomNumberGet()</code></a>.
The internal generator algorithm needs to be properly seeded. By default, the
same constant value is assigned to the seed. This means that each time function
<a href="../apiref/#tbxrandomnumberget"><code>TbxRandomNumberGet()</code></a> is called, you get a different number, but the consecutive
numbers will always be the same each time your program is restarted:</p>
<table>
<thead>
<tr>
<th style="text-align: right;">Reset #1</th>
<th style="text-align: right;">Reset #2</th>
<th style="text-align: right;">Reset #3</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">3196210335</td>
<td style="text-align: right;">3196210335</td>
<td style="text-align: right;">3196210335</td>
</tr>
<tr>
<td style="text-align: right;">2375684060</td>
<td style="text-align: right;">2375684060</td>
<td style="text-align: right;">2375684060</td>
</tr>
<tr>
<td style="text-align: right;">3691277220</td>
<td style="text-align: right;">3691277220</td>
<td style="text-align: right;">3691277220</td>
</tr>
<tr>
<td style="text-align: right;">3596136368</td>
<td style="text-align: right;">3596136368</td>
<td style="text-align: right;">3596136368</td>
</tr>
</tbody>
</table>
<p>For some applications, this behavior is acceptable. However, most applications
require different random numbers to be generated each time the software program
is started. This is achieved by calling <a href="../apiref/#tbxrandomsetseedinithandler"><code>TbxRandomSetSeedInitHandler()</code></a> to
register your own seed initialization function.</p>
<p>The ideal implementation of your seed initialization function is such that it
returns a different seed value, each time the software program is newly started.
Here are some possible approaches to realize such a changing seed value:</p>
<ol>
<li>Keep one of the analog inputs on your microcontroller unconnected. Such a
   floating analog input picks up noise from the surrounding environment and
   readings will therefore always vary slightly. Configure your ADC peripheral
   to perform an analog to digital conversion of this analog input and use its
   result value to seed the generator.</li>
<li>If your microcontroller has EEPROM or a non-volatile register, you can use it
   to store a value that you use to seed the generator. Then simply increment
   its value by one upon software program startup. This way you have a different
   seed value every time your software program is started.</li>
<li>Keep in mind though that these data storage options have a limited amount
     of write cycles. A better option might be to use external FRAM.</li>
<li>If your microcontroller has access to an external file system such as an
   SD-card, you could store a value, which you use to seed the generator, in a
   file. Then simply increment its value by one upon software program startup.
   This way you have a different seed value every time your software program is
   started.</li>
<li>If your microcontroller based system features a battery backed real-time
   clock, you could use the current date/time value to seed the generator
   algorithm.</li>
</ol>
<p>Here are the results of a demo program that implements method (1) with the
floating analog input to seed the generator algorithm:  </p>
<table>
<thead>
<tr>
<th style="text-align: right;">Reset #1</th>
<th style="text-align: right;">Reset #2</th>
<th style="text-align: right;">Reset #3</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: right;">1193105914</td>
<td style="text-align: right;">99986390</td>
<td style="text-align: right;">2131584566</td>
</tr>
<tr>
<td style="text-align: right;">3607630837</td>
<td style="text-align: right;">1266123007</td>
<td style="text-align: right;">2093232</td>
</tr>
<tr>
<td style="text-align: right;">2184628642</td>
<td style="text-align: right;">3493368727</td>
<td style="text-align: right;">1164981103</td>
</tr>
<tr>
<td style="text-align: right;">793839531</td>
<td style="text-align: right;">296055939</td>
<td style="text-align: right;">3318979929</td>
</tr>
</tbody>
</table>
<h2 id="examples">Examples</h2>
<p>To generate a new random number, call the function <a href="../apiref/#tbxrandomnumberget"><code>TbxRandomNumberGet()</code></a> and it
will return a new 32-bit random number. Example:</p>
<pre><code class="language-c">uint32_t number;

/* Generate a new random number. */
number = TbxRandomNumberGet();
</code></pre>
<p>The following function is an example implementation of an application specific
seed initialization. It is based on the above described method (1) where a
floating analog input provides randomness upon each read of the analog pin:</p>
<pre><code class="language-c">uint32_t CustomSeedInitHandler(void)
{
  /* Create a 32-bit seed value by combining two reads of the floating analog
   * pin.
   */
  return (AnalogFloatGet() &lt;&lt; 16u) | AnalogFloatGet();
}
</code></pre>
<p>The above example assumes that the application provides the function
<code>AnalogFloatGet()</code> for performing an analog to digital conversion of the analog
input pin that is left floating.</p>
<p>To register the function <code>CustomSeedInitHandler()</code> with the random number
generator software component, make the following function call during the
initialization of your software program:</p>
<pre><code class="language-c">/* Register application specific seed initialization function. */
TbxRandomSetSeedInitHandler(CustomSeedInitHandler);
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../lists/" class="btn btn-neutral float-left" title="Linked lists"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../checksum/" class="btn btn-neutral float-right" title="Checksums">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/feaser/microtbx" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../lists/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../checksum/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
